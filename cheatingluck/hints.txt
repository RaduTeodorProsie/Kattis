Really good problem. Write a dp. Then optimize the dp.